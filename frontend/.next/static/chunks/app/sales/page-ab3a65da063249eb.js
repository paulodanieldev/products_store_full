(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{8240:function(e,t,l){Promise.resolve().then(l.bind(l,8179))},8179:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return p}});var a=l(7437),s=l(23),i=l(2265),r=l(9733),d=l(8185),n=l(7209),c=l(402),o=l(9888);function x(e){var t,l,s,x,h;let{sale:u,onBack:p}=e,[j,f]=(0,i.useState)(),[m,b]=(0,i.useState)(!0),[y,v]=(0,i.useState)(null),[N,g]=(0,i.useState)([]),[w,_]=(0,i.useState)({sale_id:0,product_id:0,quantity:0,price:0,total:0,tax:0}),[S,k]=(0,i.useState)(0),[C,q]=(0,i.useState)(0);async function T(){let e=w.quantity*w.price;w.tax=await E(w.product_id,e),w.total=e+w.tax,k(S+w.total),q(C+w.tax),g([...N,w]),_({sale_id:0,product_id:0,quantity:0,price:0,total:0,tax:0})}async function E(e,t){let l=await fetch("".concat("http://localhost:8101","/sales/calculateTax"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,total:t})});return l.ok?(await l.json()).tax_result:(v(Error("Failed to fetch")),0)}async function F(){let e=await fetch("".concat("http://localhost:8101","/products"));if(!e.ok){v(Error("Failed to fetch"));return}f(await e.json()),b(!1)}async function I(){let e=await fetch("".concat("http://localhost:8101","/sales/").concat(null==u?void 0:u.id,"/getSaleItems"));if(!e.ok){v(Error("Failed to fetch"));return}g(await e.json())}async function P(){if(0===N.length){v(Error("Please add items"));return}let e=await fetch("".concat("http://localhost:8101","/sales/createSalesItems"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({total:S,total_tax:C,items:N})});if(!e.ok){v(Error("Failed to create"));return}e.ok&&p()}async function O(){if(0===N.length){v(Error("Please add items"));return}if(!(await fetch("".concat("http://localhost:8101","/sales/").concat(null==u?void 0:u.id,"/updateSalesItems"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({total:S,total_tax:C,items:N})})).ok){v(Error("Failed to update"));return}}return((0,i.useEffect)(()=>{F(),(null==u?void 0:u.id)&&(I(),k((null==u?void 0:u.total)||0),q((null==u?void 0:u.total_tax)||0))},[]),(0,i.useEffect)(()=>{(async()=>{if((null==w?void 0:w.product_id)>0&&(null==w?void 0:w.quantity)>0){let e=null==j?void 0:j.find(e=>e.id===w.product_id);if(e&&e.price){let t=Number(e.price);if(!isNaN(t)){let e=w.quantity*t,l=await E(w.product_id,e);_({...w,total:+(e+l).toFixed(2),price:+t.toFixed(2),tax:+l.toFixed(2)})}}}})()},[null==w?void 0:w.product_id,null==w?void 0:w.quantity,j]),m)?(0,a.jsx)("p",{children:"Loading..."}):y?(0,a.jsxs)("p",{children:["Error: ",y&&(null==y?void 0:y.message)]}):(0,a.jsxs)(d.Zb,{className:"w-[100%]",children:[(0,a.jsxs)(d.Ol,{children:[(0,a.jsxs)(d.ll,{children:[(null==u?void 0:u.id)?"Update":"Create"," Sale"]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsxs)("span",{children:["Total: ",S]}),(0,a.jsxs)("span",{children:["Tax: ",C]})]})})]}),(0,a.jsxs)(d.aY,{children:[(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"grid grid-cols-6 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c._,{htmlFor:"product-type",children:"Product"}),(0,a.jsxs)(o.Ph,{onValueChange:e=>_({...w,product_id:parseInt(e)}),value:null==w?void 0:null===(t=w.product_id)||void 0===t?void 0:t.toString(),children:[(0,a.jsx)(o.i4,{id:"product-type",children:(0,a.jsx)(o.ki,{placeholder:"Select"})}),(0,a.jsx)(o.Bw,{position:"popper",children:j&&j.map(e=>(0,a.jsx)(o.Ql,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c._,{htmlFor:"qty",children:"Qty"}),(0,a.jsx)(n.I,{onChange:e=>_({...w,quantity:parseInt(e.target.value)}),value:null==w?void 0:null===(l=w.quantity)||void 0===l?void 0:l.toString(),id:"qty",name:"qty",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c._,{htmlFor:"price",children:"Price"}),(0,a.jsx)(n.I,{value:null==w?void 0:null===(s=w.price)||void 0===s?void 0:s.toString(),id:"price",name:"price",required:!0,disabled:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c._,{htmlFor:"tax",children:"Tax"}),(0,a.jsx)(n.I,{value:null==w?void 0:null===(x=w.tax)||void 0===x?void 0:x.toString(),id:"tax",name:"tax",required:!0,disabled:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(c._,{htmlFor:"total",children:"Total"}),(0,a.jsx)(n.I,{value:null==w?void 0:null===(h=w.total)||void 0===h?void 0:h.toString(),id:"total",name:"total",required:!0,disabled:!0})]}),(0,a.jsx)("div",{className:"flex items-end justify-end",children:(0,a.jsx)(r.z,{onClick:T,children:"Add"})})]})}),(0,a.jsx)("div",{className:"border-t mt-10"}),(0,a.jsx)("div",{className:"overflow-x-auto w-full mt-10",children:(0,a.jsxs)("table",{className:"min-w-full bg-white border border-gray-200",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Name"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Qty"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Price"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Tax"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Total"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b text-right",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:N&&N.map((e,t)=>{var l;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-2 px-4 border-b text-left",children:null==j?void 0:null===(l=j.find(t=>t.id===e.product_id))||void 0===l?void 0:l.name}),(0,a.jsx)("td",{className:"py-2 px-4 border-b text-left",children:e.quantity}),(0,a.jsx)("td",{className:"py-2 px-4 border-b text-left",children:e.price}),(0,a.jsx)("td",{className:"py-2 px-4 border-b text-left",children:e.tax}),(0,a.jsx)("td",{className:"py-2 px-4 border-b text-left",children:e.total}),(0,a.jsx)("td",{className:"py-2 px-4 border-b text-right",children:(0,a.jsx)("button",{onClick:()=>(function(e){let t=N.filter((t,l)=>l===e);k(S-t[0].total),q(C-t[0].tax),g(N.filter((t,l)=>l!==e))})(t),className:"text-red-500 hover:underline",children:"Delete"})})]},t)})})]})})]}),(0,a.jsxs)(d.eW,{className:"flex justify-between",children:[(0,a.jsx)(r.z,{variant:"outline",onClick:p,children:"Cancel"}),(null==u?void 0:u.id)?(0,a.jsx)(r.z,{onClick:O,children:"Update Sale"}):(0,a.jsx)(r.z,{onClick:P,children:"Save Sale"})]})]})}var h=l(9354),u=l(5212);function p(){let{dataSales:e,deleteSale:t,loading:l,error:d}=(0,u.b)(),[n,c]=(0,i.useState)(null);if(l)return(0,a.jsx)("p",{children:"Loading..."});if(d)return(0,a.jsxs)("p",{children:["Error: ",d&&(null==d?void 0:d.message)]});return(0,a.jsxs)(s.x,{className:"desktop-body flex w-full h-full py-16 mx-auto items-center justify-center overflow-auto pl-[230px] pr-[50px]",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-center mb-8",children:"Sales"}),n?(0,a.jsx)(x,{sale:n||{},onBack:()=>c(null)}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex justify-end w-full mb-4",children:(0,a.jsx)(r.z,{onClick:()=>c({}),children:"Add New"})}),(0,a.jsx)("div",{className:"overflow-x-auto w-full",children:(0,a.jsxs)("table",{className:"min-w-full bg-white border border-gray-200",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"ID"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Date"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Total"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b text-left",children:"Total Tax"}),(0,a.jsx)("th",{className:"py-2 px-4 border-b text-right",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:e&&e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-2 px-4 border-b text-left",children:e.id}),(0,a.jsx)("td",{className:"py-2 px-4 border-b text-left",children:(0,h.o0)(e.sale_date)}),(0,a.jsx)("td",{className:"py-2 px-4 border-b text-left",children:e.total}),(0,a.jsx)("td",{className:"py-2 px-4 border-b text-left",children:e.total_tax}),(0,a.jsxs)("td",{className:"py-2 px-4 border-b text-right",children:[(0,a.jsx)("button",{onClick:()=>c(e),className:"text-blue-500 hover:underline mr-4",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>o(e.id),className:"text-red-500 hover:underline",children:"Delete"})]})]},e.id))})]})})]})]});async function o(e){confirm("Are you sure you want to delete this item?")&&await t(e)}}}},function(e){e.O(0,[707,833,24,971,23,744],function(){return e(e.s=8240)}),_N_E=e.O()}]);